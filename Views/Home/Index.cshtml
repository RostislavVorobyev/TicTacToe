@{
    Layout = null;
}

<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js">
<!--<![endif]-->
<head>
    <title>Tic-Tac-Toe</title>
    <link href="Content/Site.css" rel="stylesheet" />
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <link href="~/Content/Site.css" rel="stylesheet" />
</head>
<body>
    <script src="~/Scripts/jquery-2.1.4.js"></script>
    <script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
    <script src="/signalr/hubs"></script>

    <script>
        $(function () {
            // Pre-load resources
            var x = new Image();
            x.src = "/Content/Images/TicTacToeX.png";
            var o = new Image();
            o.src = "/Content/Images/TicTacToeO.png";

            $("#register").show();
            $("#findOpponent").hide();
            $("#waitingForOpponent").hide();
            $("#game").hide();
            $("#findAnotherGame").hide();

            var game = $.connection.game;

            game.client.waitingForOpponent = function (message) {
                $("#information").html("<strong>Изчакай опонета прави ход</strong>");
                //$('#debug').append('<li>Изчакай опонета прави ход</li>');
            };
            game.client.waitingForMarkerPlacement = function (message) {
                $("#information").html("<strong>Ти си на ход</strong>");
               // $('#debug').append('<li>You\'re up, make your move!</li>');
            };
            game.client.foundOpponent = function (message) {
                $("#findAnotherGame").hide();
                $("#waitingForOpponent").hide();
                $("#gameInformation").html("Играеш под името: " + message);
                //$('#debug').append('<li>You\'re playing against ' + message + '</li>');

                $("#game").html('<div id="information" /><br/>');
                for (var i = 0; i < 9; i++) {

                    $("#game").append("<span id=" + i + " class='box' />");
                }

                $("#game").show();
            };
            game.client.noOpponents = function (message) {
                $("#information").html("<strong>Looking for an opponent!</strong>");
                //$('#debug').append('<li>Waiting for opponents to connect...</li>');
            };
            game.client.addMarkerPlacement = function (message) {
                if (message.OpponentName !== $('#gamaName').val()) {
                    $("#" + message.MarkerPosition).addClass("mark2");
                    $("#" + message.MarkerPosition).addClass("marked");
                    $("#information").html("<strong>Ти си</strong>");
                } else {
                    $("#" + message.MarkerPosition).addClass("mark1");
                    $("#" + message.MarkerPosition).addClass("marked");
                    $("#information").html("<strong>Изчакай опонента да направи своя ход</strong>");
                }
                $('#debug').append('<li>Marker was placed by ' + message.OpponentName + ' at position ' + message.MarkerPosition + '</li>');
            };
            game.client.opponentDisconnected = function (message) {
                $("#gameInformation").html("<strong>Ти загуби " + message + " left and you won on walk over</strong>");
                //$('#debug').append('<li>Your opponent left! Congratulations you won!</li>');

                $("#findAnotherGame").show();
                $("#game").hide();
            };
            game.client.registerComplete = function (message) {
                $('#debug').append('<li>Можеш да започнеш</li>');
            };
            game.client.gameOver = function (message) {
                $("#gameInformation").html("You're playing against " + message);
                $("#information").html('<strong>Победител е ' + message + '</strong>');
                //$('#debug').append('<li>Game is over and We have a Winner!! Congratulations ' + message + '</li>');
                $("#findAnotherGame").show();
            }
            game.client.refreshAmountOfPlayers = function (message) {
                $("#amountOfGames").html(message.amountOfGames);
                $("#amountOfClients").html(message.amountOfClients);
                $("#totalAmountOfGames").html(message.totalGamesPlayed);
            };
            $("#game").on("click", ".box", function (event) {
                if ($(this).hasClass("marked")) return;

                game.server.play(event.target.id);
            });
            $("#registerName").click(function () {
                game.server.registerClient($('#gamaName').val());

                $("#register").hide();
                $("#findOpponent").show();
            });

            $(".findGame").click(function () {
                findGame();
            });
            $("#findAnotherGame").click(function () {
                $("#gameInformation").html("");
                $("#game").hide();
                $("#findAnotherGame").hide();
                game.server.registerClient($('#gamaName').val());

                findGame();
            });
            function findGame() {
                game.server.findOpponent();
                $("#waitingForOpponent").show();
                $("#register").hide();
                $("#findOpponent").hide();
            }

            $.connection.hub.start().done();
        });
    </script>
    <span id="gameInformation"></span>
    <div>
        <div id="register">
            <strong>Име</strong>
            <input type="text" class="input" id="gamaName" />
            <br />
            <input type="button" class="button" id="registerName" value="Започни игра" />
        </div>
        <div id="findOpponent">
            <strong>Сега потърси опонент</strong>
            <em>You're just a small way from beating your first opponent!</em><br />
            <input type="button" class="button findGame" id="findGame" value="Търси опонент" />
        </div>
        <div id="waitingForOpponent">We're searching for an opponent, please wait!</div>
        <div id="game">
        </div>
        <div class="clear"><input type="button" class="button findGame" id="findAnotherGame" value="Find a new Opponent!" /></div>
        <fieldset>
            <!--<legend>Debug message</legend>-->
            <ul id="debug"></ul>
        </fieldset>
    </div>
    <!--<div id="serverInformation">
        Amount of players connected:  <span id="amountOfClients">0</span><br />
        Amount of games currently being played: <span id="amountOfGames">0</span><br />
        Total amount of games played: <span id="totalAmountOfGames">0</span><br />
        <br />
        <br />
    </div>-->
</body>
</html>

